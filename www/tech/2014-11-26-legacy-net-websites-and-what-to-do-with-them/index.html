<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-77648562-1"></script>
  
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="One two buckle shoe">
  <title>Legacy ASP.NET Websites</title>
  <!-- <link rel="stylesheet" href="/assets/css/theme-light.css" media="(prefers-color-scheme: light)"> -->
  <!-- <link rel="stylesheet" href="/assets/css/theme-dark.css" media="(prefers-color-scheme: dark)"> -->
  <link rel="stylesheet" href="/assets/css/theme-light.css">
  
  <link rel="stylesheet" href="/assets/css/site.css">
  
  <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/prism/9000.0.1/themes/prism-okaidia.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <link rel="preload" href="/pagefind/pagefind-ui.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
</head>

<body><header>
  <a href="/" class="logo">
    <span>
      CCH
    </span>
    <svg viewBox="-10 0 660 512">
      <use href="/assets/img/coffee.svg#x"></use>
    </svg>
  </a>
  <nav>
    <a href="/">Home</a>
    <a href="/about">About</a> 
    <span><a id="show-search">Click here</a> for search or press Cmd+K</span>
  </nav>
  <span>
  </span>
</header>

  <main>
    <article>
      <h1>Legacy ASP.NET Websites</h1> 
      <h2>2014-11-26</h2>
      <p>So, you've got an old <a href="http://ASP.NET">ASP.NET</a> website using the now (or so it seems) disliked Web Forms that really needs upgrading but you simply don't  have the time or resources to devote to the task. But making incremental changes with all the good new stuff is difficult because websites don't play as well with the VS tools like web projects do. Some problems:</p>
<ul>
<li>
<p>I am forced to convert a website to a web project - a bit of a task in itself as there is no natural converion method or tools to do this.</p>
</li>
<li>
<p>My old site is problem enough so I want to be able to upload an .aspx page without having to build the whole site everytime I want to make a change - <a href="http://ASP.NET">ASP.NET</a> websites allow me to do this, projects do not. I also don't want to use a web project because I end up with all this in my file system.</p>
</li>
</ul>
<p><picture><source type="image/webp" srcset="/.11ty/image/?src=src%2Fassets%2Fimg%2Fposts%2F20141126%2Fsolution-explorer.jpg&width=447&format=webp&via=transform 447w"><img src="/.11ty/image/?src=src%2Fassets%2Fimg%2Fposts%2F20141126%2Fsolution-explorer.jpg&width=447&format=jpeg&via=transform" alt="" width="447" height="838"></picture></p>
<p>The bloated solution VS creates that I have to pick through and then remove the bits I don't want (shouldn't it be the other way round?).</p>
<p>I just want to add the odd controller and build from there. And although it's not obvious it can be done.</p>
<p>Add the correct libraries. This took some effort as MVC uses a lot of extension methods so it isn't always apparent that the correct library is loaded. Also, the namespaces can be confusing - Microsoft.AspNet.Mvc and System.Web.Mvc both appear to be the same upon inspection. The files below are the only ones you will need.</p>
<p><picture><source type="image/webp" srcset="/.11ty/image/?src=src%2Fassets%2Fimg%2Fposts%2F20141126%2Frequired-libraries.jpg&width=207&format=webp&via=transform 207w"><img src="/.11ty/image/?src=src%2Fassets%2Fimg%2Fposts%2F20141126%2Frequired-libraries.jpg&width=207&format=jpeg&via=transform" alt="" width="207" height="95"></picture></p>
<p>Add the correct handlers and assemblies to web.config. Needless to say when you install stuff via VS or Nuget you get a lot of unncessary boiler plate additions you can live without. Here is a barebones example of what you need in web.config.</p>
<pre class="language-xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0"?></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>system.web</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>compilation</span> <span class="token attr-name">targetFramework</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>4.5<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>assemblies</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>add</span> <span class="token attr-name">assembly</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>System.Net.Http, Version=4.0.0.0, Culture=neutral, PublicKeyToken=B03F5F7F11D50A3A<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>add</span> <span class="token attr-name">assembly</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>System.Web.Mvc, Version=4.0.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>assemblies</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>compilation</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>system.web</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>runtime</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>assemblyBinding</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>urn:schemas-microsoft-com:asm.v1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependentAssembly</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>assemblyIdentity</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Newtonsoft.Json<span class="token punctuation">"</span></span>
          <span class="token attr-name">publicKeyToken</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>30ad4fe6b2a6aeed<span class="token punctuation">"</span></span> <span class="token attr-name">culture</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>neutral<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bindingRedirect</span> <span class="token attr-name">oldVersion</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0.0.0.0-6.0.0.0<span class="token punctuation">"</span></span> <span class="token attr-name">newVersion</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>6.0.0.0<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependentAssembly</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>assemblyBinding</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>runtime</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>system.webServer</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>handlers</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>remove</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ExtensionlessUrlHandler-Integrated-4.0<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>remove</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>OPTIONSVerbHandler<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>remove</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>TRACEVerbHandler<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>add</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ExtensionlessUrlHandler-Integrated-4.0<span class="token punctuation">"</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>*.<span class="token punctuation">"</span></span>
        <span class="token attr-name">verb</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>*<span class="token punctuation">"</span></span><span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>System.Web.Handlers.TransferRequestHandler<span class="token punctuation">"</span></span>
        <span class="token attr-name">preCondition</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>integratedMode,runtimeVersionv4.0<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>handlers</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>system.webServer</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">></span></span></code></pre>
<p>Add the routes you want to use with your application. This one through me as the MapHttpRoute method is an extension method and it doesn't appear with code completion even after the site is built. The code is executed at the start so I have placed it in the Global.asax code behind.</p>
<pre class="language-vbnet"><code class="language-vbnet"><span class="token keyword">Imports</span> <span class="token keyword">System</span>.Web.Http
<span class="token keyword">Imports</span> <span class="token keyword">System</span>.Web.Routing

<span class="token keyword">Public</span> <span class="token keyword">Class</span> AppStart
  <span class="token keyword">Inherits</span> HttpApplication

  <span class="token keyword">Protected</span> <span class="token keyword">Sub</span> Application_Start<span class="token punctuation">(</span>sender <span class="token keyword">As</span> <span class="token keyword">Object</span><span class="token punctuation">,</span> e <span class="token keyword">As</span> EventArgs<span class="token punctuation">)</span>

    RouteTable.Routes.MapHttpRoute<span class="token punctuation">(</span><span class="token string">"webApi"</span><span class="token punctuation">,</span> <span class="token string">"api/{controller}/{action}"</span><span class="token punctuation">,</span> _
      <span class="token keyword">New</span> <span class="token keyword">With</span> <span class="token punctuation">{</span>.action <span class="token operator">=</span> RouteParameter.<span class="token keyword">Optional</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
      
  <span class="token keyword">End</span> <span class="token keyword">Sub</span>

<span class="token keyword">End</span> <span class="token keyword">Class</span></code></pre>
<p>Now we have a router in place we can start adding some controls. For this example I've just added a simple web user control that mimics a login control.</p>
<pre class="language-aspnet"><code class="language-aspnet"><span class="token page-directive tag"><span class="token page-directive tag">&lt;%@ Control</span> <span class="token page-directive tag">%></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>api/login<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Username<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span> <span class="token attr-name">required</span> <span class="token punctuation">/></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Password<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">required</span> <span class="token punctuation">/></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Login<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span></code></pre>
<p>The control is placed in master page in this example.</p>
<pre class="language-aspnet"><code class="language-aspnet"><span class="token page-directive tag"><span class="token page-directive tag">&lt;%@ Master</span> <span class="token page-directive tag">%></span></span>
<span class="token page-directive tag"><span class="token page-directive tag">&lt;%@ Register</span> <span class="token attr-name">Src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Login.ascx<span class="token punctuation">"</span></span> <span class="token attr-name">TagName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Login<span class="token punctuation">"</span></span> <span class="token attr-name">TagPrefix</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>uc1<span class="token punctuation">"</span></span> <span class="token page-directive tag">%></span></span>

<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>ASP.NET Website with Web Api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">uc1:</span>Login</span> <span class="token attr-name">runat</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>server<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">runat</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>server<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">asp:</span>ContentPlaceHolder</span> <span class="token attr-name">ID</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>content<span class="token punctuation">"</span></span> <span class="token attr-name">runat</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>server<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre>
<p>Finally to wrap it all up a controller is added to manage the http requests. For this example I created the POCO &quot;User&quot; object which is sent via a post request. Because Web API automatically maps the request type to the controller you can simply call the method &quot;Post&quot;.</p>
<pre class="language-vbnet"><code class="language-vbnet"><span class="token keyword">Imports</span> <span class="token keyword">System</span>.Web.Http

<span class="token keyword">Public</span> <span class="token keyword">Class</span> LoginController
  <span class="token keyword">Inherits</span> ApiController
  
  <span class="token keyword">Public</span> <span class="token keyword">Sub</span> Post<span class="token punctuation">(</span><span class="token operator">&lt;</span>FromBody<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">></span> user <span class="token keyword">As</span> User<span class="token punctuation">)</span>

    <span class="token keyword">Dim</span> <span class="token keyword">name</span> <span class="token operator">=</span> <span class="token string">"login-error"</span>
  
    <span class="token keyword">If</span> user.<span class="token keyword">Name</span> <span class="token operator">=</span> <span class="token string">"matt"</span> <span class="token keyword">And</span> user.Password <span class="token operator">=</span> <span class="token string">"password"</span> <span class="token keyword">Then</span>
      <span class="token keyword">name</span> <span class="token operator">=</span> <span class="token string">"welcome"</span>
    <span class="token keyword">End</span>
    
    HttpContext.Current.Response.Redirect<span class="token punctuation">(</span><span class="token keyword">String</span>.Format<span class="token punctuation">(</span><span class="token string">"/{0}.html"</span><span class="token punctuation">,</span> <span class="token keyword">name</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token keyword">End</span> <span class="token keyword">Sub</span>

<span class="token keyword">End</span> <span class="token keyword">Class</span></code></pre>
<p>So now when we navigate to an aspx page and enter the details in the login form we have Web API working alongside Web Forms.</p>
<p><picture><source type="image/webp" srcset="/.11ty/image/?src=src%2Fassets%2Fimg%2Fposts%2F20141126%2Flogin-form.jpg&width=557&format=webp&via=transform 557w"><img src="/.11ty/image/?src=src%2Fassets%2Fimg%2Fposts%2F20141126%2Flogin-form.jpg&width=557&format=jpeg&via=transform" alt="" width="557" height="168"></picture></p>
<p>And we can debug just as we would if we were using a VS Web Project rather than a more simple website.</p>
<p><picture><source type="image/webp" srcset="/.11ty/image/?src=src%2Fassets%2Fimg%2Fposts%2F20141126%2Fdebugging.jpg&width=846&format=webp&via=transform 846w"><img src="/.11ty/image/?src=src%2Fassets%2Fimg%2Fposts%2F20141126%2Fdebugging.jpg&width=846&format=jpeg&via=transform" alt="" width="846" height="382"></picture></p>
<p>This is a really basic example and is missing a few things (session state for example) and I usually code in C# but copied this code from a website I currently support. It is possible to have both C# and <a href="http://VB.NET">VB.NET</a> running side by side (another reason I didn't want to convert the website to a project) but that's a post for another day.</p>
<p>Please add comments below and let me know if you found this useuful.</p>
<p>All the code for this post can be found on github <a href="https://github.com/matthewblott/WebsiteWithApi">here</a>.</p>

    </article>
  </main><footer>
  <nav>
    <ul>
      <li><a href="">Home</a></li>
      <li><a href="">About</a></li>
    </ul>
    <ul>
      <li><a href="">Contact</a></li>
      <li><a href="">Blog</a></li>
    </ul>
    <ul>
      <li><a href="">GitHub</a></li>
      <li><a href="">Twitter</a></li>
    </ul>
  </nav>
</footer>

  <script src="/pagefind/pagefind-ui.js" defer=""></script>
  
  <script src="/assets/js/main.js"></script>
  
</body>
</html>
