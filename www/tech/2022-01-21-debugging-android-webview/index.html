<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-77648562-1"></script>
  
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="One two buckle shoe">
  <title>Debugging Android NativeScript WebViews</title>
  <!-- <link rel="stylesheet" href="/assets/css/theme-light.css" media="(prefers-color-scheme: light)"> -->
  <!-- <link rel="stylesheet" href="/assets/css/theme-dark.css" media="(prefers-color-scheme: dark)"> -->
  <link rel="stylesheet" href="/assets/css/theme-light.css">
  
  <link rel="stylesheet" href="/assets/css/site.css">
  
  <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/prism/9000.0.1/themes/prism-okaidia.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <link rel="preload" href="/pagefind/pagefind-ui.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
</head>

<body><header>
  <a href="/" class="logo">
    <span>
      CCH
    </span>
    <svg viewBox="-10 0 660 512">
      <use href="/assets/img/coffee.svg#x"></use>
    </svg>
  </a>
  <nav>
    <a href="/">Home</a>
    <a href="/about">About</a> 
    <span><a id="show-search">Click here</a> for search or press Cmd+K</span>
  </nav>
  <span>
  </span>
</header>

  <main>
    <article>
      <h1>Debugging Android NativeScript WebViews</h1> 
      <h2>2022-01-21</h2>
      <h2>The Problem</h2>
<p>Trying to implement a Three.js library in an app I needed to use a WebView and hit a problem when I tested it on Android. Although it worked fine on iOS (at least for the configuration I was using) I couldn't find out what the issue was on Android. I'd not done any WebView debugging before and the cryptic message I was getting in the logs wasn't entirely clear. A quick search came up with lots of answers on how to use Chrome Dev tools to inspect the device like this example <a href="https://medium.com/android-news/debugging-android-webview-using-chrome-developer-tools-8ce9c13ab9e5">here</a>. Essentially you need to type <code>chrome://inspect</code> in the browser and any connected devices will automatically display, much the same as you do for Safari:</p>
<p><picture><source type="image/webp" srcset="/.11ty/image/?src=src%2Fassets%2Fimg%2Ftech%2F2022-01-21-safari-devices.jpg&width=742&format=webp&via=transform 742w"><img src="/.11ty/image/?src=src%2Fassets%2Fimg%2Ftech%2F2022-01-21-safari-devices.jpg&width=742&format=jpeg&via=transform" alt="" width="742" height="206"></picture></p>
<p>However none of the Android examples I found however showed me how to enable debugging whereas In Safari it just worked. I spent an inordinate amount of time playing with the device and browser settings, getting increasingly frustrated. I tried different variations of Chrome (Google, Edge, Brave) but had no luck, I always found the device but did not have a link to load it for inspection:</p>
<p><picture><source type="image/webp" srcset="/.11ty/image/?src=src%2Fassets%2Fimg%2Ftech%2F2022-01-21-chrome-devices.jpg&width=701&format=webp&via=transform 701w"><img src="/.11ty/image/?src=src%2Fassets%2Fimg%2Ftech%2F2022-01-21-chrome-devices.jpg&width=701&format=jpeg&via=transform" alt="" width="701" height="402"></picture></p>
<h2>The Solution</h2>
<p>Then I stumbled across <a href="https://docs.microsoft.com/en-us/microsoft-edge/devtools-guide-chromium/remote-debugging/webviews">this</a> in the Microsoft Edge documentations. To enable debugging the <code>setWebContentsDebuggingEnabled</code> property needs to be set to <code>true</code>. This was the important 'gotcha' missing in all the examples I'd seen. However, enabling it in NativeScript wasn't obvious. Fortunately I'd done some manipulation of the WebView properties before by capturing the object on the page <code>onLoaded</code> event:</p>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>page</span> <span class="token attr-name"><span class="token namespace">on:</span>loaded</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>{onLoaded}</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>webView</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>webView<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>~/assets/index.html<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>page</span><span class="token punctuation">></span></span></code></pre>
<p>And then obtaining the WebView object and making adjustments for the platform like so:</p>
<pre class="language-js"><code class="language-js">
<span class="token keyword">function</span> <span class="token function">onLoaded</span><span class="token punctuation">(</span><span class="token parameter">args</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">const</span> page <span class="token operator">=</span> args<span class="token punctuation">.</span>object<span class="token punctuation">;</span>
  <span class="token keyword">const</span> view <span class="token operator">=</span> page<span class="token punctuation">.</span><span class="token function">getViewById</span><span class="token punctuation">(</span><span class="token string">'webView'</span><span class="token punctuation">)</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>view<span class="token punctuation">.</span>android<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    view<span class="token punctuation">.</span>android<span class="token punctuation">.</span><span class="token function">getSettings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAllowFileAccess</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
    view<span class="token punctuation">.</span>android<span class="token punctuation">.</span><span class="token function">getSettings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAllowContentAccess</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre>
<p>Unfortunately simply adding <code>view.android.getSettings().setWebContentsDebuggingEnabled(true)</code> didn't work when I tried it. The Microsoft docs give the examples using Java which was no good to me but a bit of digging and I found <a href="https://github.com/NativeScript/NativeScript/issues/4819">this</a> NativeScript thread on Github which showed me the correct line to add:</p>
<pre class="language-js"><code class="language-js">android<span class="token punctuation">.</span>webkit<span class="token punctuation">.</span>WebView<span class="token punctuation">.</span><span class="token function">setWebContentsDebuggingEnabled</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span></code></pre>
<p>Once I did this when I next browsed <code>chrome://inspect</code> (or <code>brave://inspect</code> or <code>edge://inspect</code> for that matter) I could see a link to inspect the device:</p>
<p><picture><source type="image/webp" srcset="/.11ty/image/?src=src%2Fassets%2Fimg%2Ftech%2F2022-01-21-chrome-devices-accessible.jpg&width=755&format=webp&via=transform 755w"><img src="/.11ty/image/?src=src%2Fassets%2Fimg%2Ftech%2F2022-01-21-chrome-devices-accessible.jpg&width=755&format=jpeg&via=transform" alt="" width="755" height="467"></picture></p>
<p>And inspect the underlying JavaScript to find the offending error:</p>
<p><picture><source type="image/webp" srcset="/.11ty/image/?src=src%2Fassets%2Fimg%2Ftech%2F2022-01-21-chrome-device-debugging.jpg&width=641&format=webp&via=transform 641w"><img src="/.11ty/image/?src=src%2Fassets%2Fimg%2Ftech%2F2022-01-21-chrome-device-debugging.jpg&width=641&format=jpeg&via=transform" alt="" width="641" height="304"></picture></p>
<p>It turned out to be Chrome not allowing Three.js to load files using the <code>file://</code> protocol. Now I need to find a way to fix this!</p>

    </article>
  </main><footer>
  <nav>
    <ul>
      <li><a href="">Home</a></li>
      <li><a href="">About</a></li>
    </ul>
    <ul>
      <li><a href="">Contact</a></li>
      <li><a href="">Blog</a></li>
    </ul>
    <ul>
      <li><a href="">GitHub</a></li>
      <li><a href="">Twitter</a></li>
    </ul>
  </nav>
</footer>

  <script src="/pagefind/pagefind-ui.js" defer=""></script>
  
  <script src="/assets/js/main.js"></script>
  
</body>
</html>
